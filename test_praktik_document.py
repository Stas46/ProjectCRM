#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –û–û–û –ü–†–ê–ö–¢–ò–ö
"""

import re

def test_praktik_document():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –û–û–û –ü–†–ê–ö–¢–ò–ö"""
    
    # –†–µ–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    test_text = """
–û–±—Ä–∞–∑–µ—Ü –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –ø–æ—Ä—É—á–µ–Ω–∏—è
–§–ò–õ–ò–ê–õ "–°–ê–ù–ö–¢-–ü–ï–¢–ï–†–ë–£–†–ì–°–ö–ò–ô" –ê–û "–ê–õ–¨–§–ê-–ë–ê–ù–ö" –≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –ë–ò–ö 044030786
–°—á. ‚Ññ 30101810600000000786
–ë–∞–Ω–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
–ò–ù–ù 7804702556 –ö–ü–ü 780401001.0 –°—á. ‚Ññ 40702810432650000500
–û–û–û "–ü–†–ê–ö–¢–ò–ö" –í–∏–¥ –æ–ø. 01 –°—Ä–æ–∫ –ø–ª–∞—Ç.
–ù–∞–∑. –ø–ª. –û—á–µ—Ä. –ø–ª–∞—Ç. 5.0
–ö–æ–¥ –ó–ö25090–ü–£–¢0007840007 –†–µ–∑. –ø–æ–ª–µ
–ü–æ–ª—É—á–∞—Ç–µ–ª—å
–û–ø–ª–∞—Ç–∞ –ø–æ –∑–∞–∫–∞–∑—É –∫–ª–∏–µ–Ω—Ç–∞ ‚Ññ–£–¢-784
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
–°—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É ‚Ññ –£–¢-784 –æ—Ç 16 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥.
–ü–æ—Å—Ç–∞–≤—â–∏–∫: –û–û–û "–ü–†–ê–ö–¢–ò–ö", –ò–ù–ù 7804702556, –ö–ü–ü 780401001, 195197, –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –≥, –≤–Ω.—Ç–µ—Ä.–≥. –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥ –§–∏–Ω–ª—è–Ω–¥—Å–∫–∏–π –æ–∫—Ä—É–≥, —É–ª –ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è, –¥. 13, –ª–∏—Ç–µ—Ä–∞ –ê, –ø–æ–º–µ—â. 5–ù, 6–ù, 22–ù, 23–ù, 32–ù, 33–ù, 34–ù,35–ù, 36–ù, 37–ù, 38–ù, 39–ù, 40–ù, 42–ù, 43–ù,44–ù, 45–ù,–ü–û–ú–ï–©. 40–ù, —Ç–µ–ª.: (812)326-05-47
–ü–æ–∫—É–ø–∞—Ç–µ–ª—å: –ò–ü –¢–∫–∞—á–µ–≤ –°—Ç–∞–Ω–∏—Å–ª–∞–≤ –û–ª–µ–≥–æ–≤–∏—á, –ò–ù–ù 784802613697, –ì–æ—Ä–æ–¥ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –≤–Ω.—Ç–µ—Ä.–≥. –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–π –æ–∫—Ä—É–≥ –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –∑–∞—Å—Ç–∞–≤–∞
‚Ññ –¢–æ–≤–∞—Ä—ã (—Ä–∞–±–æ—Ç—ã, —É—Å–ª—É–≥–∏) –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¶–µ–Ω–∞ –°—Ç–∞–≤–∫–∞ –ù–î–° –°—É–º–º–∞ –ù–î–° –°—É–º–º–∞
1 –ü—Ä–æ—Ñ–∏–ª—å —Å—Ç–æ–π–∫–∏ AYPC.F50.0103 (—Ü–≤. RAL7016M) 6.8 –º 1631.61 20 1849...
    """
    
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –û–û–û –ü–†–ê–ö–¢–ò–ö...")
    print(f"üìù –û–∂–∏–¥–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:")
    print(f"   - –ü–æ—Å—Ç–∞–≤—â–∏–∫: –û–û–û –ü–†–ê–ö–¢–ò–ö")
    print(f"   - –ò–ù–ù –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞: 7804702556")
    print(f"   - –ù–æ–º–µ—Ä —Å—á–µ—Ç–∞: –£–¢-784")
    print(f"   - –î–∞—Ç–∞: 16 —Å–µ–Ω—Ç—è–±—Ä—è 2025")
    print(f"   - –ü–æ–∫—É–ø–∞—Ç–µ–ª—å: –ò–ü –¢–∫–∞—á–µ–≤ –°—Ç–∞–Ω–∏—Å–ª–∞–≤ –û–ª–µ–≥–æ–≤–∏—á (–∏—Å–∫–ª—é—á–∏—Ç—å)\n")
    
    # –¢–µ—Å—Ç 1: –ù–æ–º–µ—Ä —Å—á–µ—Ç–∞
    invoice_number_match = re.search(r'(?:–°–ß–ï–¢|–°—á–µ—Ç)\s*(?:–Ω–∞ –æ–ø–ª–∞—Ç—É\s*)?‚Ññ\s*([–ê-–Ø\d\-]+)', test_text, re.IGNORECASE) or \
                          re.search(r'‚Ññ\s*([–ê-–Ø\d\-]+)\s*–æ—Ç', test_text, re.IGNORECASE)
    
    print("üîç –¢–µ—Å—Ç –Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–∞:")
    if invoice_number_match:
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω –Ω–æ–º–µ—Ä: {invoice_number_match.group(1)}")
    else:
        print("   ‚ùå –ù–æ–º–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    # –¢–µ—Å—Ç 2: –î–∞—Ç–∞
    invoice_date_match = re.search(r'–æ—Ç\s*(\d{1,2})\s*([–∞-—è—ë]+)\s*(\d{4})', test_text, re.IGNORECASE) or \
                        re.search(r'(\d{1,2})\s*([–∞-—è—ë]+)\s*(\d{4})\s*–≥', test_text, re.IGNORECASE)
    
    print("üîç –¢–µ—Å—Ç –¥–∞—Ç—ã:")
    if invoice_date_match:
        day = invoice_date_match.group(1)
        month = invoice_date_match.group(2)
        year = invoice_date_match.group(3)
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –¥–∞—Ç–∞: {day} {month} {year}")
        
        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞
        months = {
            '—è–Ω–≤–∞—Ä—è': '01', '—Ñ–µ–≤—Ä–∞–ª—è': '02', '–º–∞—Ä—Ç–∞': '03', '–∞–ø—Ä–µ–ª—è': '04',
            '–º–∞—è': '05', '–∏—é–Ω—è': '06', '–∏—é–ª—è': '07', '–∞–≤–≥—É—Å—Ç–∞': '08',
            '—Å–µ–Ω—Ç—è–±—Ä—è': '09', '–æ–∫—Ç—è–±—Ä—è': '10', '–Ω–æ—è–±—Ä—è': '11', '–¥–µ–∫–∞–±—Ä—è': '12'
        }
        month_num = months.get(month.lower(), '01')
        iso_date = f"{year}-{month_num}-{day.zfill(2)}"
        print(f"   ‚úÖ ISO —Ñ–æ—Ä–º–∞—Ç: {iso_date}")
    else:
        print("   ‚ùå –î–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
    
    # –¢–µ—Å—Ç 3: –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç
    contractor_patterns = [
        r'–ü–æ—Å—Ç–∞–≤—â–∏–∫[:\s]*([^,\n]*?(?:–û–û–û|–ò–ü|–ê–û|–ó–ê–û|–û–ê–û|–ü–ê–û)[^,\n]*)',
        r'((?:–û–û–û|–ò–ü|–ê–û|–ó–ê–û|–û–ê–û|–ü–ê–û)[^,\n]*)',
    ]
    
    contractor_name = None
    print("üîç –¢–µ—Å—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞:")
    for pattern in contractor_patterns:
        match = re.search(pattern, test_text, re.IGNORECASE)
        if match:
            contractor_name = match.group(1).strip()
            # –ò—Å–∫–ª—é—á–∞–µ–º –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
            if not re.search(r'–ü–æ–∫—É–ø–∞—Ç–µ–ª—å|–ó–∞–∫–∞–∑—á–∏–∫|–¢–∫–∞—á–µ–≤', contractor_name, re.IGNORECASE):
                print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: {contractor_name}")
                break
    
    if not contractor_name:
        print("   ‚ùå –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    # –¢–µ—Å—Ç 4: –ò–ù–ù (–∏—Å–∫–ª—é—á–∞–µ–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è)
    buyer_inns = []
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –ò–ù–ù –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
    buyer_sections = [
        r'–ó–∞–∫–∞–∑—á–∏–∫:[\s\S]*?–ò–ù–ù[\s:]*(\d{10,12})',
        r'–ü–æ–∫—É–ø–∞—Ç–µ–ª—å:[\s\S]*?–ò–ù–ù[\s:]*(\d{10,12})'
    ]
    
    for pattern_str in buyer_sections:
        pattern = re.compile(pattern_str, re.IGNORECASE)
        for match in pattern.finditer(test_text):
            buyer_inns.append(match.group(1))
            print(f"üö´ –ù–∞–π–¥–µ–Ω –ò–ù–ù –ø–æ–∫—É–ø–∞—Ç–µ–ª—è (–∏—Å–∫–ª—é—á–∞–µ–º): {match.group(1)}")
    
    # –ò—â–µ–º –ò–ù–ù –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
    supplier_inn_match = re.search(r'–ü–æ—Å—Ç–∞–≤—â–∏–∫[\s\S]*?–ò–ù–ù[\s:]*(\d{10,12})', test_text, re.IGNORECASE)
    
    print("üîç –¢–µ—Å—Ç –ò–ù–ù:")
    if supplier_inn_match and supplier_inn_match.group(1) not in buyer_inns:
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω –ò–ù–ù –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞: {supplier_inn_match.group(1)}")
    else:
        print("   ‚ùå –ò–ù–ù –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    print("\nüéØ –ò—Ç–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
    success = True
    
    if invoice_number_match and invoice_number_match.group(1) == "–£–¢-784":
        print("   ‚úÖ –ù–æ–º–µ—Ä —Å—á–µ—Ç–∞: –ü–†–û–ô–î–ï–ù")
    else:
        print("   ‚ùå –ù–æ–º–µ—Ä —Å—á–µ—Ç–∞: –ù–ï –ü–†–û–ô–î–ï–ù")
        success = False
        
    if invoice_date_match and invoice_date_match.group(1) == "16" and invoice_date_match.group(2) == "—Å–µ–Ω—Ç—è–±—Ä—è":
        print("   ‚úÖ –î–∞—Ç–∞: –ü–†–û–ô–î–ï–ù–ê")
    else:
        print("   ‚ùå –î–∞—Ç–∞: –ù–ï –ü–†–û–ô–î–ï–ù–ê")
        success = False
        
    if contractor_name and "–ü–†–ê–ö–¢–ò–ö" in contractor_name:
        print("   ‚úÖ –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: –ü–†–û–ô–î–ï–ù")
    else:
        print("   ‚ùå –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: –ù–ï –ü–†–û–ô–î–ï–ù")
        success = False
        
    if supplier_inn_match and supplier_inn_match.group(1) == "7804702556":
        print("   ‚úÖ –ò–ù–ù: –ü–†–û–ô–î–ï–ù")
    else:
        print("   ‚ùå –ò–ù–ù: –ù–ï –ü–†–û–ô–î–ï–ù")
        success = False
    
    if success:
        print("\nüéâ –û–ë–©–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢: –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
    else:
        print("\nüí• –û–ë–©–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢: –ï–°–¢–¨ –û–®–ò–ë–ö–ò!")

if __name__ == "__main__":
    test_praktik_document()