<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª—É—á–µ–Ω–∏–µ IAM-—Ç–æ–∫–µ–Ω–∞ Yandex Cloud</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f7fafc;
        }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .step { 
            background: #f8f9fa; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid #4299e1;
        }
        .method { 
            background: #e6fffa; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid #38b2ac;
        }
        .command { 
            background: #2d3748; 
            color: #e2e8f0; 
            padding: 15px; 
            border-radius: 6px; 
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
        }
        .warning { 
            background: #fef5e7; 
            border-left: 4px solid #f6ad55; 
            padding: 15px; 
            margin: 10px 0;
        }
        .success { 
            background: #f0fff4; 
            border-left: 4px solid #48bb78; 
            padding: 15px; 
            margin: 10px 0;
        }
        .btn {
            background: #4299e1;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn:hover { background: #3182ce; }
        .oauth-section {
            background: #fff5f5;
            border: 2px solid #fc8181;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 10px;
            font-family: monospace;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîë –ü–æ–ª—É—á–µ–Ω–∏–µ IAM-—Ç–æ–∫–µ–Ω–∞ –¥–ª—è Yandex Cloud Vision</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> IAM-—Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ 12 —á–∞—Å–æ–≤. –î–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è API-–∫–ª—é—á.
        </div>

        <div class="method">
            <h2>üåê –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)</h2>
            
            <div class="step">
                <h3>–®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ OAuth-—Ç–æ–∫–µ–Ω</h3>
                <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å OAuth-—Ç–æ–∫–µ–Ω:</p>
                <button class="btn" onclick="getOAuthToken()">üîó –ü–æ–ª—É—á–∏—Ç—å OAuth-—Ç–æ–∫–µ–Ω</button>
                <p><small>–≠—Ç–æ –æ—Ç–∫—Ä–æ–µ—Ç –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω.</small></p>
                
                <label for="oauthToken">–í—Å—Ç–∞–≤—å—Ç–µ OAuth-—Ç–æ–∫–µ–Ω —Å—é–¥–∞:</label>
                <textarea id="oauthToken" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ OAuth-—Ç–æ–∫–µ–Ω –∑–¥–µ—Å—å..."></textarea>
            </div>

            <div class="step">
                <h3>–®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ IAM-—Ç–æ–∫–µ–Ω</h3>
                <button class="btn" onclick="getIAMToken()">üéØ –ü–æ–ª—É—á–∏—Ç—å IAM-—Ç–æ–∫–µ–Ω</button>
                <div id="iamResult" style="margin-top: 15px;"></div>
            </div>
        </div>

        <div class="method">
            <h2>üíª –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ Yandex Cloud CLI</h2>
            
            <div class="step">
                <h3>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ CLI</h3>
                <p>–î–ª—è Windows PowerShell:</p>
                <div class="command">iex (New-Object System.Net.WebClient).DownloadString('https://storage.yandexcloud.net/yandexcloud-yc/install.ps1')</div>
            </div>

            <div class="step">
                <h3>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞</h3>
                <div class="command">
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–æ–¥–∏–Ω —Ä–∞–∑)
yc init

# –ü–æ–ª—É—á–µ–Ω–∏–µ IAM-—Ç–æ–∫–µ–Ω–∞
yc iam create-token
                </div>
            </div>
        </div>

        <div class="success">
            <h2>‚úÖ –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞</h2>
            <p>–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª <code>.env.local</code>:</p>
            <div class="command">
# IAM —Ç–æ–∫–µ–Ω (–æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤)
YANDEX_IAM_TOKEN=t1.9eu...–≤–∞—à_iam_—Ç–æ–∫–µ–Ω...
YANDEX_CLOUD_FOLDER_ID=b1g...–≤–∞—à_folder_id...
            </div>
        </div>

        <div class="oauth-section">
            <h2>üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API-–∫–ª—é—á –≤–º–µ—Å—Ç–æ IAM-—Ç–æ–∫–µ–Ω–∞!</h2>
            <p>API-–∫–ª—é—á –Ω–µ –∏—Å—Ç–µ–∫–∞–µ—Ç –∏ –ø—Ä–æ—â–µ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏:</p>
            <ol>
                <li>–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å —Ä–æ–ª—å—é <code>ai.vision.user</code></li>
                <li>–°–æ–∑–¥–∞–π—Ç–µ –¥–ª—è –Ω–µ–≥–æ API-–∫–ª—é—á</li>
                <li>–î–æ–±–∞–≤—å—Ç–µ –≤ <code>.env.local</code>:</li>
            </ol>
            <div class="command">
YANDEX_VISION_API_KEY=AQVN...–≤–∞—à_api_–∫–ª—é—á...
YANDEX_CLOUD_FOLDER_ID=b1g...–≤–∞—à_folder_id...
            </div>
        </div>
    </div>

    <script>
        function getOAuthToken() {
            window.open('https://oauth.yandex.ru/authorize?response_type=token&client_id=1a6990aa636648e9b2ef855fa7bec2fb', '_blank');
        }

        async function getIAMToken() {
            const oauthToken = document.getElementById('oauthToken').value.trim();
            const resultDiv = document.getElementById('iamResult');
            
            if (!oauthToken) {
                resultDiv.innerHTML = '<div style="color: red;">‚ùå –í–≤–µ–¥–∏—Ç–µ OAuth-—Ç–æ–∫–µ–Ω</div>';
                return;
            }

            resultDiv.innerHTML = '<div style="color: blue;">üîÑ –ü–æ–ª—É—á–∞–µ–º IAM-—Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ –Ω–∞—à API...</div>';

            try {
                const response = await fetch('/api/get-iam-token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        oauthToken: oauthToken
                    })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="color: green;">‚úÖ IAM-—Ç–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!</div>
                        <div style="background: #2d3748; color: #e2e8f0; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; word-break: break-all;">
                            ${data.iamToken}
                        </div>
                        <div style="color: orange;">‚ö†Ô∏è –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: ${new Date(data.expiresAt).toLocaleString('ru-RU')}</div>
                        <div style="margin-top: 10px;">
                            <button class="btn" onclick="copyToClipboard('${data.iamToken}')">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω</button>
                            <button class="btn" onclick="addToEnvFile('${data.iamToken}')">‚öôÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É .env.local</button>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${data.error}<br><small>${data.details || ''}</small></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ IAM-—Ç–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }

        function addToEnvFile(iamToken) {
            const envConfig = `
# –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–π–ª .env.local:

YANDEX_IAM_TOKEN=${iamToken}
YANDEX_CLOUD_FOLDER_ID=ajeqqov5lheces6lehjn

# –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: npm run dev
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                background: rgba(0,0,0,0.8); z-index: 1000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%;">
                    <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env.local</h3>
                    <textarea readonly style="width: 100%; height: 150px; font-family: monospace;">${envConfig}</textarea>
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="copyToClipboard(\`${envConfig}\`)">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
                        <button class="btn" onclick="document.body.removeChild(this.closest('div').closest('div'))" style="background: #666;">‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>