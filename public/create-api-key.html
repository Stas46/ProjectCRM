<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª—é—á–∞ –¥–ª—è Yandex Vision</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .step { background: #f0f8ff; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #4299e1; }
        .important { background: #fff5f5; border-left: 4px solid #fc8181; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .success { background: #f0fff4; border-left: 4px solid #48bb78; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .warning { background: #fffbf0; border-left: 4px solid #f6ad55; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .code { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 6px; font-family: monospace; margin: 10px 0; }
        .btn { background: #4299e1; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; text-decoration: none; display: inline-block; }
        .btn:hover { background: #3182ce; }
        .btn-green { background: #48bb78; }
        .btn-green:hover { background: #38a169; }
        .btn-orange { background: #f6ad55; }
        .btn-orange:hover { background: #ed8936; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîë –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª—é—á–∞ –¥–ª—è Yandex Vision</h1>
        
        <div class="important">
            <h3>‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞:</h3>
            <p>–û—à–∏–±–∫–∞ <strong>403 Permission denied</strong> –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç–µ–∫—É—â–∏–π IAM —Ç–æ–∫–µ–Ω –Ω–µ –∏–º–µ–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤ –¥–ª—è Yandex Vision API.</p>
            <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –°–æ–∑–¥–∞—Ç—å API –∫–ª—é—á –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è IAM —Ç–æ–∫–µ–Ω–∞.</p>
        </div>

        <div class="step">
            <h2>üåê –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å Yandex Cloud</h2>
            <a href="https://console.cloud.yandex.ru/" target="_blank" class="btn">üîó –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å Yandex Cloud</a>
            <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç.</p>
        </div>

        <div class="step">
            <h2>üë§ –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç</h2>
            <ol>
                <li>–í –º–µ–Ω—é —Å–ª–µ–≤–∞ –Ω–∞–π–¥–∏—Ç–µ <strong>"–°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã"</strong></li>
                <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç"</strong></li>
                <li>–£–∫–∞–∂–∏—Ç–µ –∏–º—è: <code>vision-ocr-service</code></li>
                <li>–î–æ–±–∞–≤—å—Ç–µ —Ä–æ–ª—å: <strong><code>ai.vision.user</code></strong></li>
                <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ–∑–¥–∞—Ç—å"</strong></li>
            </ol>
        </div>

        <div class="step">
            <h2>üîë –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á</h2>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç</li>
                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É <strong>"API-–∫–ª—é—á–∏"</strong></li>
                <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ–∑–¥–∞—Ç—å API-–∫–ª—é—á"</strong></li>
                <li>–£–∫–∞–∂–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ: <code>Vision OCR API Key</code></li>
                <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ–∑–¥–∞—Ç—å"</strong></li>
                <li><strong>‚ö†Ô∏è –í–ê–ñ–ù–û:</strong> –°–∫–æ–ø–∏—Ä—É–π—Ç–µ API –∫–ª—é—á —Å—Ä–∞–∑—É! –û–Ω –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω.</li>
            </ol>
        </div>

        <div class="warning">
            <h3>üìã –§–æ—Ä–º–∞—Ç API –∫–ª—é—á–∞:</h3>
            <p>API –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:</p>
            <div class="code">AQVN...–ø—Ä–∏–º–µ—Ä_api_–∫–ª—é—á–∞...</div>
            <p>–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å <code>AQVN</code> –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã.</p>
        </div>

        <div class="success">
            <h2>‚öôÔ∏è –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ .env.local</h2>
            <p>–ó–∞–º–µ–Ω–∏—Ç–µ IAM —Ç–æ–∫–µ–Ω –Ω–∞ API –∫–ª—é—á –≤ —Ñ–∞–π–ª–µ .env.local:</p>
            <div class="code">
# –£–î–ê–õ–ò–¢–ï —ç—Ç—É —Å—Ç—Ä–æ–∫—É:
# YANDEX_IAM_TOKEN=t1.9euelZr...

# –î–û–ë–ê–í–¨–¢–ï —ç—Ç—É —Å—Ç—Ä–æ–∫—É:
YANDEX_VISION_API_KEY=AQVN...–≤–∞—à_api_–∫–ª—é—á...

# Folder ID –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å:
YANDEX_CLOUD_FOLDER_ID=b1g...–≤–∞—à_folder_id...
            </div>
        </div>

        <div class="step">
            <h2>üöÄ –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä</h2>
            <ol>
                <li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª .env.local</li>
                <li>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C)</li>
                <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞: <code>npm run dev</code></li>
                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</li>
            </ol>
            
            <div style="margin-top: 20px;">
                <a href="http://localhost:3003/test-center" class="btn btn-green">üß™ –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</a>
                <button class="btn btn-orange" onclick="checkApiKey()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á</button>
            </div>
        </div>

        <div class="important">
            <h3>üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ API –∫–ª—é—á–∞:</h3>
            <ul>
                <li>‚úÖ –ù–µ –∏—Å—Ç–µ–∫–∞–µ—Ç (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç IAM —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤)</li>
                <li>‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞</li>
                <li>‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ API</li>
                <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –¥–ª—è Vision API –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</li>
            </ul>
        </div>

        <div id="apiKeyCheck" style="margin-top: 20px;"></div>
    </div>

    <script>
        async function checkApiKey() {
            const resultDiv = document.getElementById('apiKeyCheck');
            resultDiv.innerHTML = '<div style="color: blue;">üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á...</div>';

            try {
                const response = await fetch('/api/yandex-config-check');
                const data = await response.json();

                let apiKeyStatus = '';
                if (data.config.hasApiKey) {
                    apiKeyStatus = '<div style="color: green;">‚úÖ API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω</div>';
                } else if (data.config.hasIamToken) {
                    apiKeyStatus = '<div style="color: orange;">‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è IAM —Ç–æ–∫–µ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è API –∫–ª—é—á)</div>';
                } else {
                    apiKeyStatus = '<div style="color: red;">‚ùå –ù–µ—Ç API –∫–ª—é—á–∞ –∏–ª–∏ IAM —Ç–æ–∫–µ–Ω–∞</div>';
                }

                let folderStatus = '';
                if (data.config.hasFolderId && data.config.folderIdStartsCorrect) {
                    folderStatus = '<div style="color: green;">‚úÖ Folder ID –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ</div>';
                } else {
                    folderStatus = '<div style="color: red;">‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å Folder ID</div>';
                }

                resultDiv.innerHTML = `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #6c757d;">
                        <h3>üìä –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</h3>
                        ${apiKeyStatus}
                        ${folderStatus}
                        <div style="margin-top: 10px;">
                            <strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:</strong> ${data.config.hasApiKey ? '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞!' : '–°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—ã—à–µ'}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = '<div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ API –∫–ª—é—á–∞</div>';
            }
        }
    </script>
</body>
</html>