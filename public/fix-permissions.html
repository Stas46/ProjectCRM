<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è Yandex Vision</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .step { background: #f0f8ff; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #4299e1; }
        .important { background: #fff5f5; border-left: 4px solid #fc8181; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .success { background: #f0fff4; border-left: 4px solid #48bb78; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .warning { background: #fffbf0; border-left: 4px solid #f6ad55; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .code { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 6px; font-family: monospace; margin: 10px 0; }
        .btn { background: #4299e1; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; text-decoration: none; display: inline-block; }
        .btn:hover { background: #3182ce; }
        .btn-green { background: #48bb78; }
        .btn-green:hover { background: #38a169; }
        .btn-red { background: #fc8181; }
        .btn-red:hover { background: #f56565; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è Yandex Vision</h1>
        
        <div class="important">
            <h3>üö® –ü—Ä–æ–±–ª–µ–º–∞:</h3>
            <p>–û—à–∏–±–∫–∞ <strong>403 Permission denied</strong> –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É <code>vision-ocr-service</code> –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥—É.</p>
            <p><strong>ID —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:</strong> <code>ajeh6lbokias41tbjk1m</code></p>
        </div>

        <div class="step">
            <h2>üåê –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞</h2>
            <a href="https://console.cloud.yandex.ru/folders/b1g...–≤–∞—à_folder_id.../access" target="_blank" class="btn">üîó –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
            <p>–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:</p>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://console.cloud.yandex.ru/" target="_blank">–∫–æ–Ω—Å–æ–ª—å Yandex Cloud</a></li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ <strong>default</strong></li>
                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>"–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞"</strong></li>
            </ol>
        </div>

        <div class="step">
            <h2>üë§ –®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç</h2>
            <ol>
                <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª–∏"</strong></li>
                <li>–í –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤–≤–µ–¥–∏—Ç–µ: <code>vision-ocr-service</code></li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞</li>
                <li>–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ä–æ–ª–∏:</li>
            </ol>
            
            <div class="warning">
                <h3>üéØ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–æ–ª–∏:</h3>
                <ul>
                    <li><strong><code>ai.vision.user</code></strong> - –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Vision API</li>
                    <li><strong><code>resource-manager.folder.viewer</code></strong> - –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h2>üîë –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª–∏</h2>
            <p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –µ—Å—Ç—å —Ä–æ–ª–∏:</p>
            <div class="code">
‚úÖ ai.vision.user (—É–∂–µ –µ—Å—Ç—å)
‚ûï resource-manager.folder.viewer (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)
            </div>
        </div>

        <div class="success">
            <h2>üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)</h2>
            <p>–ü–æ–ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <strong>–ª–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç</strong> –≤–º–µ—Å—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ:</p>
            
            <h3>üìã –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ API –∫–ª—é—á–∞:</h3>
            <ol>
                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>"–ë–∏–ª–ª–∏–Ω–≥"</strong> –≤ –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud</li>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç</li>
                <li>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</li>
                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>"API –∫–ª—é—á–∏"</strong> (–≤ —Ä–∞–∑–¥–µ–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞)</li>
                <li>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á –¥–ª—è —Å–≤–æ–µ–≥–æ –ª–∏—á–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</li>
            </ol>
            
            <div style="margin-top: 20px;">
                <a href="https://console.cloud.yandex.ru/iam/api-keys" target="_blank" class="btn btn-green">üîë –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π API –∫–ª—é—á</a>
                <a href="http://localhost:3004/test-center" target="_blank" class="btn">üß™ –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</a>
            </div>
        </div>

        <div class="warning">
            <h3>üîÑ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤:</h3>
            <ol>
                <li>–ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è)</li>
                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Yandex Vision</li>
                <li>–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π API –∫–ª—é—á</li>
            </ol>
        </div>

        <div class="important">
            <h3>üìä –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</h3>
            <div class="code">
–°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç: vision-ocr-service (ajeh6lbokias41tbjk1m)
API –∫–ª—é—á: aje79of9fr7sdjd2sfcq
Folder ID: b1g...–≤–∞—à_folder_id...
–†–æ–ª—å Vision: ‚úÖ ai.vision.user
–†–æ–ª—å –∫–∞—Ç–∞–ª–æ–≥–∞: ‚ùì –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å resource-manager.folder.viewer
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn btn-red" onclick="testConfiguration()">üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
        </div>

        <div id="testResult" style="margin-top: 20px;"></div>
    </div>

    <script>
        async function testConfiguration() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div style="color: blue;">üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Yandex Vision...</div>';

            try {
                // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç - –ø—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º 1x1 –ø–∏–∫—Å–µ–ª—å
                const canvas = document.createElement('canvas');
                canvas.width = 1;
                canvas.height = 1;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, 1, 1);
                
                canvas.toBlob(async (blob) => {
                    const formData = new FormData();
                    formData.append('file', blob, 'test.png');
                    
                    try {
                        const response = await fetch('/api/yandex-vision-test', {
                            method: 'POST',
                            body: formData
                        });
                        
                        const result = await response.json();
                        
                        if (result.ocrResults && result.ocrResults.success) {
                            resultDiv.innerHTML = `
                                <div style="background: #f0fff4; padding: 15px; border-radius: 8px; border-left: 4px solid #48bb78;">
                                    <h3>‚úÖ –£—Å–ø–µ—Ö!</h3>
                                    <p>Yandex Vision API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!</p>
                                    <p>–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.</p>
                                </div>
                            `;
                        } else {
                            const errorMsg = result.ocrResults?.errorMessage || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
                            resultDiv.innerHTML = `
                                <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #fc8181;">
                                    <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                                    <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> ${errorMsg}</p>
                                    <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –î–æ–±–∞–≤—å—Ç–µ —Ä–æ–ª—å resource-manager.folder.viewer –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π API –∫–ª—é—á.</p>
                                </div>
                            `;
                        }
                    } catch (error) {
                        resultDiv.innerHTML = `
                            <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #fc8181;">
                                <h3>‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞</h3>
                                <p>${error.message}</p>
                            </div>
                        `;
                    }
                }, 'image/png');
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #fff5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #fc8181;">
                        <h3>‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>