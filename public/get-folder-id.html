<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª—É—á–µ–Ω–∏–µ Folder ID –¥–ª—è Yandex Vision</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .step { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #4299e1; }
        .error { background: #fef5e7; border-left: 4px solid #f6ad55; padding: 15px; margin: 10px 0; }
        .success { background: #f0fff4; border-left: 4px solid #48bb78; padding: 15px; margin: 10px 0; }
        .btn { background: #4299e1; color: white; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        .btn:hover { background: #3182ce; }
        textarea { width: 100%; min-height: 120px; padding: 10px; font-family: monospace; border: 1px solid #ccc; border-radius: 4px; }
        .command { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 6px; font-family: monospace; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÅ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ Folder ID</h1>
        
        <div class="error">
            <strong>‚ùå –ü—Ä–æ–±–ª–µ–º–∞:</strong> Yandex Vision API —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Folder ID (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å b1g...), 
            –∞ —É –≤–∞—Å —É–∫–∞–∑–∞–Ω ID —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏ (ajeqqov5lheces6lehjn).
        </div>

        <div class="step">
            <h2>üîë –®–∞–≥ 1: –í–≤–µ–¥–∏—Ç–µ –≤–∞—à IAM —Ç–æ–∫–µ–Ω</h2>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ IAM —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø–æ–ª—É—á–∏–ª–∏ —Ä–∞–Ω–µ–µ:</p>
            <textarea id="iamToken" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ IAM —Ç–æ–∫–µ–Ω –∑–¥–µ—Å—å (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å t1.9eu...)"></textarea>
            <button class="btn" onclick="getFolderId()">üìÅ –ü–æ–ª—É—á–∏—Ç—å Folder ID</button>
        </div>

        <div id="folderResult" style="margin-top: 20px;"></div>

        <div class="step">
            <h2>üåê –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å Yandex Cloud</h2>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="https://console.cloud.yandex.ru/" target="_blank">–∫–æ–Ω—Å–æ–ª—å Yandex Cloud</a></li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∫–∞—Ç–∞–ª–æ–≥</li>
                <li>–í –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ç–∞–ª–æ–≥–µ –Ω–∞–π–¥–∏—Ç–µ <strong>"–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä"</strong></li>
                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å b1g...)</li>
            </ol>
        </div>
    </div>

    <script>
        async function getFolderId() {
            const iamToken = document.getElementById('iamToken').value.trim();
            const resultDiv = document.getElementById('folderResult');
            
            if (!iamToken) {
                resultDiv.innerHTML = '<div class="error">‚ùå –í–≤–µ–¥–∏—Ç–µ IAM —Ç–æ–∫–µ–Ω</div>';
                return;
            }

            resultDiv.innerHTML = '<div style="color: blue;">üîÑ –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–∞–ª–æ–≥–æ–≤...</div>';

            try {
                const response = await fetch('/api/get-folder-id', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        iamToken: iamToken
                    })
                });

                const data = await response.json();

                if (data.success) {
                    let foldersList = '';
                    if (data.allFolders && data.allFolders.length > 1) {
                        foldersList = '<h4>–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏:</h4><ul>';
                        data.allFolders.forEach(folder => {
                            foldersList += `<li><strong>${folder.name}</strong>: ${folder.id}</li>`;
                        });
                        foldersList += '</ul>';
                    }

                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ Folder ID –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h3>
                            <p><strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∫–∞—Ç–∞–ª–æ–≥:</strong> ${data.folderName}</p>
                            <div class="command">${data.folderId}</div>
                            ${foldersList}
                            <div style="margin-top: 15px;">
                                <button class="btn" onclick="copyToClipboard('${data.folderId}')">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Folder ID</button>
                                <button class="btn" onclick="showEnvConfig('${data.folderId}')">‚öôÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É .env.local</button>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}<br><small>${data.details || ''}</small></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Folder ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }

        function showEnvConfig(folderId) {
            const currentToken = document.getElementById('iamToken').value.trim();
            const envConfig = `
# Yandex Vision OCR - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
YANDEX_IAM_TOKEN=${currentToken}
YANDEX_CLOUD_FOLDER_ID=${folderId}

# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: npm run dev
            `;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                background: rgba(0,0,0,0.8); z-index: 1000; 
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%;">
                    <h3>‚öôÔ∏è –û–±–Ω–æ–≤–∏—Ç–µ .env.local</h3>
                    <textarea readonly style="width: 100%; height: 150px; font-family: monospace;">${envConfig}</textarea>
                    <div style="margin-top: 15px;">
                        <button class="btn" onclick="copyToClipboard(\`${envConfig}\`)">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
                        <button class="btn" onclick="document.body.removeChild(this.closest('div').closest('div'))" style="background: #666;">‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>