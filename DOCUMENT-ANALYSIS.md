# üìÑ –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ OpenAI API

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OpenAI **Responses API** + **Files API** –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ Supabase
```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª (contract.pdf)
// –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ Supabase Storage
// URL: https://supabase.../chat-files/{user_id}/{timestamp}_contract.pdf
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ OpenAI
```typescript
const uploadFileToOpenAI = async (fileUrl, fileName) => {
  // –°–∫–∞—á–∏–≤–∞–µ–º —Å Supabase
  const response = await fetch(fileUrl);
  const fileBuffer = await response.arrayBuffer();
  const file = new File([fileBuffer], fileName);
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ OpenAI Files API
  const uploaded = await openai.files.create({
    file: file,
    purpose: 'user_data'
  });
  
  return uploaded.id; // file-abc123xyz
};
```

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Responses API
```typescript
const response = await openai.responses.create({
  model: 'gpt-4o',
  input: [{
    role: 'user',
    content: [
      { type: 'input_text', text: '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–æ–≥–æ–≤–æ—Ä' },
      { type: 'input_file', file_id: 'file-abc123xyz' }
    ]
  }]
});

const answer = response.output[0].content[0].text;
```

### 4. OpenAI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
- **PDF**: –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç + —Å–æ–∑–¥–∞—ë—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
- **DOCX**: —á–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- **TXT/MD/CSV**: —á–∏—Ç–∞–µ—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç
- AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|--------|--------|------------|
| PDF | ‚úÖ | –¢–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü |
| DOCX | ‚úÖ | –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç |
| TXT | ‚úÖ | –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç |
| MD | ‚úÖ | Markdown |
| CSV | ‚úÖ | –¢–∞–±–ª–∏—Ü—ã |
| JSON | ‚úÖ | –î–∞–Ω–Ω—ã–µ |
| XLSX | ‚ùå | –ù—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CSV |

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä API

–ö–æ–¥ –≤ `/api/chat/route.ts` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç:

```typescript
if (fileIds.length > 0) {
  // –ï—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º Responses API
  const response = await openai.responses.create({...});
} else {
  // –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí Chat Completions API
  const completion = await openai.chat.completions.create({...});
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞
```
–§–∞–π–ª: contract.pdf
–ó–∞–ø—Ä–æ—Å: –ü—Ä–æ–≤–µ—Ä—å –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ —Ä–∏—Å–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

–û—Ç–≤–µ—Ç:
–í —Ä–∞–∑–¥–µ–ª–µ 5 –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—É–Ω–∫—Ç –æ —Å—Ä–æ–∫–∞—Ö —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è.
–í –ø—É–Ω–∫—Ç–µ 7.3 –≤–æ–∑–º–æ–∂–µ–Ω —Ä–∏—Å–∫ - —à—Ç—Ä–∞—Ñ–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏ –±–µ–∑ –≤—Å—Ç—Ä–µ—á–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤.
–†–µ–∫–æ–º–µ–Ω–¥—É—é –¥–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –æ —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä–µ.
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
```
–§–∞–π–ª: contacts.docx
–ó–∞–ø—Ä–æ—Å: –ò–∑–≤–ª–µ–∫–∏ –≤—Å–µ email –∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ã

–û—Ç–≤–µ—Ç:
Email: support@company.com, sales@company.com
–¢–µ–ª–µ—Ñ–æ–Ω—ã: +7 (495) 123-45-67, +7 (926) 987-65-43
```

### –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
```
–§–∞–π–ª: report.csv
–ó–∞–ø—Ä–æ—Å: –ü–æ—Å—á–∏—Ç–∞–π —Å—Ä–µ–¥–Ω—é—é –≤—ã—Ä—É—á–∫—É –∑–∞ –º–µ—Å—è—Ü

–û—Ç–≤–µ—Ç:
–°—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞: 1,250,000 —Ä—É–±–ª–µ–π
–ú–∞–∫—Å–∏–º—É–º –≤ –∏—é–Ω–µ: 1,800,000 —Ä—É–±–ª–µ–π
–ú–∏–Ω–∏–º—É–º –≤ —Ñ–µ–≤—Ä–∞–ª–µ: 950,000 —Ä—É–±–ª–µ–π
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ú–∞–∫—Å–∏–º—É–º 50MB –Ω–∞ —Ñ–∞–π–ª
- –ú–∞–∫—Å–∏–º—É–º 50MB –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
- –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ OpenAI –¥–æ 30 –¥–Ω–µ–π
- PDF —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ—Ä–æ–≥–æ (—Ç–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

## –°—Ç–æ–∏–º–æ—Å—Ç—å

### GPT-4o
- –ü—Ä–æ–º–ø—Ç: $2.5 / 1M —Ç–æ–∫–µ–Ω–æ–≤
- –û—Ç–≤–µ—Ç: $10 / 1M —Ç–æ–∫–µ–Ω–æ–≤

### GPT-4o-mini (–¥–µ—à–µ–≤–ª–µ)
- –ü—Ä–æ–º–ø—Ç: $0.15 / 1M —Ç–æ–∫–µ–Ω–æ–≤
- –û—Ç–≤–µ—Ç: $0.6 / 1M —Ç–æ–∫–µ–Ω–æ–≤

### –ü—Ä–∏–º–µ—Ä
- PDF 10 —Å—Ç—Ä–∞–Ω–∏—Ü ‚âà 8000 —Ç–æ–∫–µ–Ω–æ–≤
- –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.02 (GPT-4o) –∏–ª–∏ $0.001 (GPT-4o-mini)

## –ö–æ–¥

–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤:
- `/src/app/api/chat/route.ts` - —Ñ—É–Ω–∫—Ü–∏—è `uploadFileToOpenAI()` –∏ –≤—ã–±–æ—Ä API
- `/src/app/chat/page.tsx` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ Supabase Storage

## Next Steps

- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ file_id –≤ –ë–î (–Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ)
- [ ] –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ OpenAI —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Excel (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è XLSX ‚Üí CSV)
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ UI
