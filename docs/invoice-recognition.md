# Распознавание счетов с использованием Google Cloud Vision API

В этом документе описано, как настроить и использовать функцию распознавания счетов в CRM-системе Glazing с помощью Google Cloud Vision API.

## Что такое Google Cloud Vision API?

Google Cloud Vision API - это мощный инструмент машинного обучения для анализа изображений. Он позволяет распознавать текст (OCR), определять объекты, лица, логотипы и многое другое. В нашем проекте мы используем его для распознавания текста на счетах и извлечения важной информации, такой как номер счета, дата, сумма и т.д.

## Особенности реализации

- Поддержка распознавания текста на русском языке
- Загрузка изображений и PDF-файлов
- Извлечение ключевой информации из счетов (номер, дата, сумма, поставщик)
- Предварительный просмотр загруженных файлов
- Отображение полного распознанного текста и извлеченных данных

## Настройка Google Cloud Vision API

Для использования Google Cloud Vision API в production вам необходимо:

1. **Создать проект в Google Cloud Platform**:
   - Перейдите на [console.cloud.google.com](https://console.cloud.google.com/)
   - Создайте новый проект или выберите существующий
   - Запишите ID проекта, он понадобится позже

2. **Активировать Google Cloud Vision API**:
   - В панели навигации выберите "APIs & Services" > "Library"
   - Найдите "Cloud Vision API" и активируйте его для вашего проекта

3. **Создать учетные данные**:
   - В панели навигации выберите "APIs & Services" > "Credentials"
   - Нажмите "Create credentials" > "Service account"
   - Заполните форму и создайте сервисный аккаунт
   - Добавьте роль "Cloud Vision API User" для сервисного аккаунта
   - Создайте ключ для сервисного аккаунта (в формате JSON)
   - Загрузите файл ключа - это ваши учетные данные для API

4. **Настройка проекта**:
   - Разместите файл учетных данных в безопасном месте
   - Установите переменные окружения:
     ```
     GOOGLE_APPLICATION_CREDENTIALS=/path/to/your-credentials.json
     NEXT_PUBLIC_USE_REAL_INVOICE_RECOGNITION=true
     ```

## Ограничения бесплатного использования

Google Cloud Vision API имеет бесплатный уровень использования:
- 1,000 запросов в месяц бесплатно
- После превышения лимита: примерно $1.50 за 1,000 запросов

## Использование в режиме разработки

В режиме разработки или если учетные данные Google Cloud не настроены, система автоматически переключается на мок-реализацию, которая возвращает фиктивные данные. Это позволяет тестировать функциональность без необходимости настраивать API.

## Структура компонентов

- `src/services/invoice-recognition.ts` - Основной сервис для работы с Google Cloud Vision API
- `src/components/invoice-recognition.tsx` - React-компонент для загрузки и отображения распознанных данных
- `src/app/invoices/recognition/page.tsx` - Страница распознавания счетов

## Дальнейшие улучшения

- Улучшение алгоритмов извлечения данных с использованием регулярных выражений
- Добавление возможности сохранения распознанных счетов в базе данных
- Интеграция с системой учета и создание проводок на основе распознанных данных
- Поддержка различных форматов счетов и автоматическое определение шаблонов