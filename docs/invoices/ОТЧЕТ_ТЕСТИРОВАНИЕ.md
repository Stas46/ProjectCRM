# üìä –û–¢–ß–ï–¢: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—è —Å—á–µ—Ç–æ–≤

–î–∞—Ç–∞: 27 –Ω–æ—è–±—Ä—è 2025

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–∞ —ç—Ç–∞–ª–æ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (Baseline)
- **–§–∞–π–ª:** `docs/invoices/—ç—Ç–∞–ª–æ–Ω–Ω–∞—è_—Ç–∞–±–ª–∏—Ü–∞.csv`
- **–ú–µ—Ç–æ–¥:** –†—É—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
- **–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 37
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º

### 2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞
- **–§–∞–π–ª –æ—Ç—á–µ—Ç–∞:** `docs/invoices/–ê–ù–ê–õ–ò–ó_–ü–ê–†–°–ï–†–ê.txt`
- **–°–∫—Ä–∏–ø—Ç—ã:**
  - `scripts/extract_invoice_data_manual.py` - —Ä—É—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ
  - `scripts/analyze_parser_issues.py` - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ (—ç—Ç–∞–ª–æ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)

| –ü–æ–ª–µ | –£—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|------|-------------------|---------|
| –ù–æ–º–µ—Ä —Å—á–µ—Ç–∞ | 37/37 | **100%** ‚úÖ |
| –î–∞—Ç–∞ | 25/37 | **67.6%** ‚ö†Ô∏è |
| –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç | 25/37 | **67.6%** ‚ö†Ô∏è |
| –°—É–º–º–∞ | 18/37 | **48.6%** ‚ùå |
| –ù–î–° | 11/37 | **29.7%** ‚ùå |

## üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –î–∞—Ç–∞ –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è (12 —Ñ–∞–π–ª–æ–≤)
**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª—ã —ç—Ç–æ —Å–∫–∞–Ω—ã, –¥–∞—Ç–∞ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:**
- `–ê–ª-–ü—Ä–æ—Ñ–∏ 00000009346 –æ—Ç 24 –æ–∫—Ç—è 25.pdf`
- `–ì–µ—Ä–º–µ—Ç–∏–∫ –°–Ω–∞–± —Å–µ—Ä–≤–∏—Å ‚Ññ13334 –æ—Ç 17 –æ–∫—Ç—è–± 25.pdf`
- `–ü–µ—Ç—Ä–æ–≤–∏—á –¢–°–≠00773961 –æ—Ç 31 –æ–∫—Ç—è–± 25.pdf`

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã—Ö –º–µ—Å—è—Ü–µ–≤

### –ü—Ä–æ–±–ª–µ–º–∞ #2: –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è (12 —Ñ–∞–π–ª–æ–≤)
**–ü—Ä–∏—á–∏–Ω–∞:** –í —Å–∫–∞–Ω–∞—Ö –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

**–ü—Ä–∏–º–µ—Ä—ã:**
- `–ê–ª-–ü—Ä–æ—Ñ–∏` ‚Üí "–ê–ª-–ü—Ä–æ—Ñ–∏"
- `–ì–µ—Ä–º–µ—Ç–∏–∫ –°–Ω–∞–± —Å–µ—Ä–≤–∏—Å` ‚Üí "–ì–µ—Ä–º–µ—Ç–∏–∫ –°–Ω–∞–± —Å–µ—Ä–≤–∏—Å"  
- `–ò–ü –¢–µ–Ω–∏–∑–±–∞–µ–≤–∞` ‚Üí "–ò–ü –¢–µ–Ω–∏–∑–±–∞–µ–≤–∞"

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–≤–ª–µ–∫–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ –Ω–∞—á–∞–ª–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –°—É–º–º–∞ –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è (19 —Ñ–∞–π–ª–æ–≤)
**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ê–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç (7 —Ñ–∞–π–ª–æ–≤) - —ç—Ç–æ –Ω–µ —Å—á–µ—Ç–∞, —Å—É–º–º—ã —Ç–∞–º –Ω–µ—Ç
2. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PDF –±–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–ª–æ—è (12 —Ñ–∞–π–ª–æ–≤) - –Ω—É–∂–µ–Ω OCR

**–†–µ—à–µ–Ω–∏–µ:** 
- –†–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Å—á–µ—Ç vs –∞–∫—Ç)
- –£–ª—É—á—à–∏—Ç—å OCR –¥–ª—è —Å–∫–∞–Ω–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞ #4: Google Vision OCR –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∞ "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç" –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —á–µ—Ä–µ–∑ `/api/smart-invoice`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ò—Å—á–µ—Ä–ø–∞–Ω–∞ –∫–≤–æ—Ç–∞ Google Vision API
2. –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π/credentials
3. –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–§–∞–π–ª—ã —Å –æ—à–∏–±–∫–∞–º–∏:** –í–°–ï —Ñ–∞–π–ª—ã (100%) –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1Ô∏è‚É£ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –í–´–°–û–ö–ò–ô: –ü–∞—Ä—Å–∏–Ω–≥ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

**–î–æ–±–∞–≤–∏—Ç—å –≤ `ultimate_invoice_parser.py`:**

```python
def extract_from_filename(filename: str) -> dict:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∫–∞–∫ fallback"""
    data = {}
    
    # –î–∞—Ç–∞ –∏–∑ –∏–º–µ–Ω–∏: "–æ—Ç 24 –æ–∫—Ç—è 25"
    date_pattern = r'–æ—Ç\s+(\d{1,2})\s+(\w+)\s+(\d{2})'
    if match := re.search(date_pattern, filename):
        day, month_ru, year = match.groups()
        months = {
            '—è–Ω–≤': '01', '—Ñ–µ–≤': '02', '–º–∞—Ä—Ç': '03', '–∞–ø—Ä': '04',
            '–º–∞': '05', '–∏—é–Ω': '06', '–∏—é–ª': '07', '–∞–≤–≥': '08',
            '—Å–µ–Ω': '09', '–æ–∫—Ç': '10', '–Ω–æ—è': '11', '–¥–µ–∫': '12'
        }
        for m_name, m_num in months.items():
            if m_name in month_ru.lower():
                data['date'] = f"20{year}-{m_num}-{day.zfill(2)}"
                break
    
    # –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –∏–∑ –Ω–∞—á–∞–ª–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    company_pattern = r'^([–ê-–Ø–∞-—è\-\s]+(?:–ò–ü|–û–û–û|–ê–û)?[^‚Ññ\d]*)'
    if match := re.match(company_pattern, filename):
        company = match.group(1).strip()
        if company and len(company) > 3:
            data['contractor'] = company
    
    return data
```

### 2Ô∏è‚É£ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –°–†–ï–î–ù–ò–ô: –†–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```python
def detect_document_type(text: str, filename: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞"""
    if '–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç' in text.lower():
        return 'act'
    if '—Å—á–µ—Ç' in text.lower() or 'invoice' in text.lower():
        return 'invoice'
    if '–ê–∫—Ç' in filename:
        return 'act'
    return 'unknown'
```

### 3Ô∏è‚É£ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Google Vision OCR

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –ö–≤–æ—Ç—É Google Cloud Platform
2. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å credentials –≤ `google-credentials.json`
3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Vision API

**–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Tesseract OCR –∫–∞–∫ fallback

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
docs/invoices/
‚îú‚îÄ‚îÄ —ç—Ç–∞–ª–æ–Ω–Ω–∞—è_—Ç–∞–±–ª–∏—Ü–∞.csv          # ‚úÖ –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ä—É—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ)
‚îú‚îÄ‚îÄ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã_API.csv               # ‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ (–≤—Å–µ –æ—à–∏–±–∫–∏)
‚îú‚îÄ‚îÄ –ê–ù–ê–õ–ò–ó_–ü–ê–†–°–ï–†–ê.txt              # üìä –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚îî‚îÄ‚îÄ [37 —Ñ–∞–π–ª–æ–≤ —Å—á–µ—Ç–æ–≤]              # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

scripts/
‚îú‚îÄ‚îÄ extract_invoice_data_manual.py   # –†—É—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ analyze_parser_issues.py         # –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
‚îú‚îÄ‚îÄ test_api_recognition.py          # –¢–µ—Å—Ç API (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ OCR)
‚îî‚îÄ‚îÄ batch_process_invoices.py        # –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ö–†–ò–¢–ò–ß–ù–û:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å Google Vision OCR
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–æ—Ç—É API
   - –û–±–Ω–æ–≤–∏—Ç—å credentials –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
   - –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ Tesseract

2. **–í–ê–ñ–ù–û:** –£–ª—É—á—à–∏—Ç—å `ultimate_invoice_parser.py`
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã—Ö –º–µ—Å—è—Ü–µ–≤
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –∏–∑ –∏–º–µ–Ω–∏

3. **–ñ–ï–õ–ê–¢–ï–õ–¨–ù–û:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è OCR
   - –ü—Ä–æ–≥–Ω–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ `/api/smart-invoice`
   - –°—Ä–∞–≤–Ω–∏—Ç—å —Å —ç—Ç–∞–ª–æ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π
   - –í—ã—á–∏—Å–ª–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:
- **–î–∞—Ç–∞:** 67.6% ‚Üí **95%** (+27%)
- **–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç:** 67.6% ‚Üí **95%** (+27%)
- **–°—É–º–º–∞:** 48.6% ‚Üí **70%** (+21%) (–ø—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–º OCR)

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 27.11.2025
