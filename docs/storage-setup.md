# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase Storage –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Å—á–µ—Ç–æ–≤

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å—á–µ—Ç–æ–≤ (PDF, Excel, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –≤ Supabase Storage.
–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ –ø–æ –ø—É–±–ª–∏—á–Ω—ã–º URL
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–æ—Å—Ç—É–ø–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- CDN –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

## üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Storage Bucket

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Supabase Dashboard (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç: `fpnugtlchxigwpqwiczc`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage** –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
4. –ù–∞–∂–º–∏—Ç–µ **New Bucket**
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:
   - **Name**: `invoice-files`
   - **Public bucket**: ‚úÖ (–≤–∫–ª—é—á–∏—Ç—å –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º)
   - **File size limit**: 50 MB (–∏–ª–∏ –±–æ–ª—å—à–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - **Allowed MIME types**: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º (—Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ —Ç–∏–ø—ã)

6. –ù–∞–∂–º–∏—Ç–µ **Create bucket**

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ SQL Editor

–û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** –≤ Supabase Dashboard –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –°–æ–∑–¥–∞–µ–º bucket –¥–ª—è —Ñ–∞–π–ª–æ–≤ —Å—á–µ—Ç–æ–≤
INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
VALUES (
  'invoice-files',
  'invoice-files',
  true,
  52428800, -- 50 MB
  NULL -- —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤
);

-- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (RLS)
-- –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã
CREATE POLICY "Authenticated users can upload invoice files"
ON storage.objects
FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'invoice-files');

-- –†–∞–∑—Ä–µ—à–∞–µ–º –≤—Å–µ–º —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)
CREATE POLICY "Public can view invoice files"
ON storage.objects
FOR SELECT
TO public
USING (bucket_id = 'invoice-files');

-- –†–∞–∑—Ä–µ—à–∞–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ —Ñ–∞–π–ª—ã
CREATE POLICY "Authenticated users can delete their invoice files"
ON storage.objects
FOR DELETE
TO authenticated
USING (bucket_id = 'invoice-files');
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è bucket –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ª—é–±–æ–π —Ñ–∞–π–ª (PDF, Excel –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å URL —Ñ–∞–π–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
   ```
   https://fpnugtlchxigwpqwiczc.supabase.co/storage/v1/object/public/invoice-files/invoices/[filename]
   ```

## üìÅ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤:

### PDF
- `.pdf` - PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã
- MIME: `application/pdf`

### Excel
- `.xlsx` - Excel 2007+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `.xls` - Excel 97-2003
- `.xlsm` - Excel —Å –º–∞–∫—Ä–æ—Å–∞–º–∏
- MIME: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`

### Word
- `.docx` - Word 2007+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `.doc` - Word 97-2003
- MIME: `application/vnd.openxmlformats-officedocument.wordprocessingml.document`

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `.jpg`, `.jpeg` - JPEG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `.png` - PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `.gif` - GIF –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `.webp` - WebP –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

## üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

```
invoice-files/
  ‚îî‚îÄ‚îÄ invoices/
      ‚îú‚îÄ‚îÄ 1699876543210-abc123.pdf
      ‚îú‚îÄ‚îÄ 1699876543211-def456.xlsx
      ‚îî‚îÄ‚îÄ 1699876543212-ghi789.jpg
```

–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞: `{timestamp}-{random}.{extension}`

## ‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Bucket not found"

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É `Bucket "invoice-files" –Ω–µ –Ω–∞–π–¥–µ–Ω`:

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket —Å–æ–∑–¥–∞–Ω (—Å–º. –≤—ã—à–µ)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ bucket (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ—á–Ω–æ `invoice-files`)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã–π

### –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

–ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env.local`:
   ```bash
   NEXT_PUBLIC_SUPABASE_URL=https://fpnugtlchxigwpqwiczc.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=–≤–∞—à_service_role_–∫–ª—é—á
   ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `SUPABASE_SERVICE_ROLE_KEY`, –∞ –Ω–µ `ANON_KEY`

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   ```bash
   pm2 logs crm-glazing
   ```

### –§–∞–π–ª—ã Excel –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

–†–∞–Ω—å—à–µ –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ - Excel —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –≤ Storage.
**‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!** –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- –¢–æ–ª—å–∫–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã
- Service Role Key –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- URL —Ñ–∞–π–ª–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ, –Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Storage –º–æ–∂–Ω–æ –≤ Supabase Dashboard:

1. **Storage** ‚Üí **Settings**
2. –ü—Ä–æ—Å–º–æ—Ç—Ä:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
   - –†–∞–∑–º–µ—Ä bucket

**–õ–∏–º–∏—Ç—ã Free Plan:**
- 1 GB —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- 2 GB —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –º–µ—Å—è—Ü

**–°—Ç–æ–∏–º–æ—Å—Ç—å Pro Plan:**
- $25/–º–µ—Å—è—Ü –±–∞–∑–æ–≤—ã–π
- $0.021 –∑–∞ GB —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- $0.09 –∑–∞ GB —Ç—Ä–∞—Ñ–∏–∫–∞
